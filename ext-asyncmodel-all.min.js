Ext.defineInterface("IGridMetaDataBinder",{inherit:"ISingleton",methods:["onInit","onDestroy","onRender"]});Ext.defineInterface("IMetaDataBinder",{inherit:"ISingleton",methods:["getMetaDataName","isApplicable","onComponentBound","onComponentUnbound","applyMetaData"]});Ext.define("Ext.ux.binder.AbstractFormFieldBinder",{implement:"IMetaDataBinder",abstractClass:!0,getMetaDataName:function(){return this.metaDataName||Ext.Error.raise("metaDataName not defined"),this.metaDataName},onComponentBound:function(){},onComponentUnbound:function(){},isApplicable:function(n){return n.isFormField},applyMetaData:function(){},applyPlugin:function(n,t){n.findPlugin(t)||n.addPlugin(t)}});Ext.define("Ext.ux.binder.FormFieldReadOnlyBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",metaDataName:"readOnly",onComponentBound:function(n){this.applyPlugin(n,"readonlylatching")},applyMetaData:function(n,t){t?n.latchReadOnly():n.unlatchReadOnly()}});Ext.define("Ext.ux.binder.FormFieldRequiredBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",requiredClassName:"requiredField",metaDataName:"required",applyMetaData:function(n,t){var r=this,i=n.requiredClassName===undefined?r.requiredClassName:n.requiredClassName;t?n.addCls(i):n.removeCls(i)}});Ext.define("Ext.ux.binder.FormFieldValidationBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",metaDataName:"validationErrorMessages",onComponentBound:function(n){this.applyPlugin(n,"externalvalidating")},applyMetaData:function(n,t){n.setExternalErrors("modelValidation",t)}});Ext.define("Ext.ux.binder.GridReadOnlyBinder",{implement:"IGridMetaDataBinder",onInit:function(n){var t=this;n.on("beforeedit",t.onBeforeCellEdit)},onDestroy:function(n){var t=this;n.un("beforeedit",t.onBeforeCellEdit)},onRender:function(){},onBeforeCellEdit:function(n,t){return!t.record.getMetaValue(t.column.dataIndex,"readOnly")}});Ext.define("Ext.ux.binder.GridRequiredBinder",{implement:"IGridMetaDataBinder",requiredCellCls:"requiredGridCell",onInit:function(){},onDestroy:function(){},onRender:function(n,t){var i=n.column.dataIndex;t.getMetaValue(i,"required")&&(n.tdCls+=" "+this.requiredCellCls)}});Ext.define("Ext.ux.binder.GridValidationBinder",{implement:"IGridMetaDataBinder",invalidCellCls:"invalidGridCell",onInit:function(){},onDestroy:function(){},onRender:function(n,t){var r=n.column.dataIndex,i=t.getMetaValue(r,"validationErrorMessages");i.length?(n.tdCls+=" "+this.invalidCellCls,n.tdAttr='data-errorqtip="'+i.join("<\/br>")+'"'):n.tdAttr='data-errorqtip=""'}});Ext.define("Ext.ux.plugin.MetaDataBinding",{alias:"plugin.metadatabinding",extend:"Ext.AbstractPlugin",inject:{metaDataBinders:"IMetaDataBinder[]"},pathDelimiter:".",init:function(n){var t=this;t._formFields=new DynamicComponentQuery(n,"[isFormField]:not([excludeForm])");t._metaDataBinders=Ext.ux.util.Lookup.fromArray(t.metaDataBinders,function(n){return n.getMetaDataName()});t._modelBindingCallbacks=new Ext.ux.util.Lookup;t._modelBinds={};t._formFields.every(function(n){n._metaBound||(t.bindComponent(n),n._metaBound=!0)});t._formFields.everyRemoved(function(n){n._metaBound&&(t.unbindComponent(n),delete n._metaBound)})},bindComponent:function(n){var t=this,u=n.getBind(),f,r,c;if(u&&u.value){if(f=u.value.stub.path,r=f.split(t.pathDelimiter),r.length<2)return;var e=r[r.length-1],i=r.slice(0,-1).join(t.pathDelimiter),l=Ext.Array.insert(r,r.length-1,"meta"),o=l.join(t.pathDelimiter),s=n.lookupViewModel(),h=s.get(i);h?t.bindComponentToModelField(n,h,e,o):(t._modelBinds[i]||(c="{"+i+"}",t._modelBinds[i]=s.bind(c,function(n){n&&(t._modelBindingCallbacks.eachForKey(i,function(t){t(n)}),t._modelBindingCallbacks.removeKey(i),t._modelBinds[i].destroy())})),t._modelBindingCallbacks.add(i,function(i){t.bindComponentToModelField(n,i,e,o)}))}},unbindComponent:function(n){var t=this;n._metaBinds&&Ext.Array.forEach(n._metaBinds,function(t){t.bind.destroy();t.binder.onComponentUnbound(n)})},bindComponentToModelField:function(n,t,i,r){var u=this;if(t instanceof Ext.ux.data.AsyncModel){var e=n.lookupViewModel(),o=t.getMetaDataNames(),f=[];Ext.Array.forEach(o,function(o){var l=r+u.pathDelimiter+o,s=u.getMetaDataBinder(n,o),h,c;if(s){h="{"+l+"}";s.onComponentBound(n,t,i);s.applyMetaData(n,t.getMetaValue(i,o),t,i);c=e.bind(h,function(r){s.applyMetaData(n,r,t,i)});f.push({bind:c,binder:s})}});n._metaBinds=f}},getMetaDataBinder:function(n,t){var u=this,i,r=0;return u._metaDataBinders.eachForKey(t,function(t){var u=t.isApplicable(n);u=u===!0?1:Ext.isNumber(u)?u:0;u>r&&(i=t,r=u)}),i}});Ext.define("Ext.ux.plugin.GridMetaDataBinding",{alias:"plugin.gridmetadatabinding",extend:"Ext.AbstractPlugin",inject:{gridMetaDataBinders:"IGridMetaDataBinder[]"},mixins:["Ext.util.Observable"],init:function(n){var t=this;t._owner=n;t.mixins.observable.constructor.call(t);t.callParent(arguments);t.initBinders()},initBinders:function(){var n=this;n._bindersInitialized||(n.overrideColumnRenderers(),n.overrideGridViewOnUpdate(n._owner),n.mon(n._owner,{reconfigure:{fn:n.onReconfigure,scope:n}}),Ext.Array.each(n.gridMetaDataBinders,function(t){t.onInit(n._owner,n)}),n._bindersInitialized=!0)},destroy:function(){var n=this;n._bindersInitialized&&Ext.Array.each(n.gridMetaDataBinders,function(t){t.onDestroy(n._owner,n)})},getMetaDataMap:function(n){var i=n.columns,t=null;return Ext.each(i,function(n){n.metaDataIndex&&(t=t||{},t[n.metaDataIndex]||(t[n.metaDataIndex]=[]),t[n.metaDataIndex].push(n.dataIndex))}),t},onReconfigure:function(n,t,i){var r=this;i&&r.overrideColumnRenderers()},overrideGridViewOnUpdate:function(n){var i=this,r=i.getMetaDataMap(n),t=n.getView(),u=t.onUpdate;t.onUpdate=r?function(n,f,e,o){e!==Ext.data.Model.VALIDCHANGE&&(e===Ext.data.Model.METACHANGE&&(arguments[3]=i.updateChangedFieldNames(o,r)),u.apply(t,arguments))}:function(n,i,r){r!==Ext.data.Model.VALIDCHANGE&&u.apply(t,arguments)}},updateChangedFieldNames:function(n,t){var i=Ext.Array.clone(n);return Ext.each(n,function(n){var r=t[n];r&&(i=i.concat(r))}),i},overrideColumnRenderers:function(){var n=this,t=n._owner.columns;Ext.each(t,function(t){var i=t.renderer,r;t.xtype!=="rownumberer"&&(r=i?function(t,r,u,f,e,o,s){return t=n.renderer(t,r,u,f,e,o,s),i.apply(this,[t,r,u,f,e,o,s])}:Ext.bind(n.renderer,n),Ext.apply(t,{renderer:r,hasCustomRenderer:!0}))})},renderer:function(n,t,i,r,u,f,e){var o=this,s=t.column.dataIndex;return s&&Ext.Array.each(o.gridMetaDataBinders,function(n){n.onRender(t,i,r,u,f,e)}),n}});Ext.override("Ext.data.validator.Bound",{autoTrim:!0,getValue:function(n){var i=this,t;return n instanceof Ext.data.Store?n.count():(t=String(n),i.autoTrim&&(t=Ext.String.trim(t)),t.length)},validateValue:function(n){var t=this;return n===undefined||n===null||!t.getValue(n)?this.getEmptyMessage():!0},validate:function(n){var t=this;return n instanceof Ext.data.Model?!0:t.callParent(arguments)}});Ext.define("Ext.ux.validator.MetaDataValidatorMapper",{alternateClassName:"MetaDataValidatorMapper",singleton:!0,constructor:function(){this.map={}},assosiate:function(n,t,i){this.map[n]={config:t,fieldConfigReplications:i}},getValidatorsMap:function(){return this.map}});Ext.define("Ext.data.validator.ParametrizedValidator",{extend:"Ext.data.validator.Validator",alias:"data.validator.baseparametrizedvalidator",_infoMessage:"",validateWithOptions:function(n,t){return this.validate(n,t)},getInfoMessage:function(){return this._infoMessage}});Ext.define("Ext.data.validator.Required",{extend:"Ext.data.validator.ParametrizedValidator",alias:"data.validator.required",type:"required",config:{autoTrim:!0,requiredMessage:"This is a required field"},getValue:function(n){var i=this,t;return n instanceof Ext.data.Store?n.count():(t=String(n),i.getAutoTrim()&&(t=Ext.String.trim(t)),t.length)},validate:function(n){var t=this;return n===undefined||n===null||!t.getValue(n)?t.getRequiredMessage():!0},validateWithOptions:function(n,t,i){var r=this;return i.validatePresence?r.callParent(arguments):!0}});Ext.define("Ext.ux.data.FieldMetaModel",{extend:"Ext.data.Model",fields:[{name:"readOnly",type:"bool",defaultValue:!1},{name:"required",type:"bool",defaultValue:!1},{name:"validationErrorMessages",type:"auto",defaultValue:[]},{name:"validationInfoMessages",type:"auto",defaultValue:[]}]});Ext.define("Ext.ux.data.MetaModel",{extend:"Ext.data.Model",idProperty:"__fakeId__",constructor:function(){var n=this,t;n.callParent(arguments);t={afterEdit:function(t,i){n.callJoined("onMetaDataChanged",[t.fieldName,i,t])}};n._fieldMetaRecordsMap={};Ext.Array.forEach(n.fields,function(i){if(!i.identifier){var u="set"+Ext.String.capitalize(i.name),r=Ext.create(n.fieldMetaModelName);r.fieldName=i.name;n[u].call(n,r);r.join(t);n._fieldMetaRecordsMap[i.name]=r}});n.reset()},getMeta:function(n,t){var i=this;return i._fieldMetaRecordsMap[n].get(t)},setMeta:function(n,t,i){var r=this;return r._fieldMetaRecordsMap[n].set(t,i)},reset:function(){var n=this;Ext.Array.forEach(n.fields,function(t){t.identifier||n._fieldMetaRecordsMap[t.name].set(t.defaultValues)})},getMetaDataNames:function(){var t=this,i=Ext.ClassManager.get(t.fieldMetaModelName).fields,n=[];return Ext.Array.each(i,function(t){t.identifier||n.push(t.name)}),n},statics:{createMetaModel:function(n){var u=this,t,i,r;if(!(n instanceof Ext.ux.data.AsyncModel))throw"Ext.ux.data.MetaModel can be applied only to Ext.ux.data.AsyncModel";return t=Ext.getClassName(n)+"__Meta__",Ext.ClassManager.isCreated(t)||(i=n.fieldMetaModelName||"Ext.ux.data.FieldMetaModel",r=Ext.Array.map(n.getFieldsDescription(),function(n){var t=u.getMetaDefaults(i,n);return{name:n.name,reference:i,defaultValues:t}}),Ext.define(t,{extend:"Ext.ux.data.MetaModel",fieldMetaModelName:i,fields:r})),Ext.create(t)},getMetaDefaults:function(n,t){var r=Ext.ClassManager.get(n).fields,i={};return Ext.Array.forEach(r,function(n){n.name!=="validationErrorMessages"&&n.name!=="validationInfoMessages"&&(i[n.name]=t[n.name]||n.defaultValue||null)}),i}}});Ext.define("Ext.ux.data.AsyncModel",{extend:"Ext.data.Model",mixins:["Ext.util.Observable"],validateOnChange:!0,validateOnMetaDataChange:!1,defaultFieldErrorMessage:"Value is invalid",defaultModelErrorMessage:"Some fields have incorrect data",_businessRulesSyncCounter:0,_suppressBusinessLogic:0,_suppressValidityReset:0,_suppressValidChangeEvent:0,_suppressChangeEvent:0,_errorMessage:"",_infoMessage:"",_defaultMetaDataValidatorsMap:{required:{config:"required",fieldConfigReplications:["requiredMessage"]}},fields:[{name:"meta",reference:"Ext.ux.data.MetaModel"}],constructor:function(n,t,i){var r=this,f=Ext.clone(n),u;r.mixins.observable.constructor.call(r);r.validationRules=r.validationRules||{};r.businessRules=r.businessRules||{};r._ignoredFieldNames=[];r._modifiedNestedFieldNames=[];r._validationCallbacks=[];r._businessLogicSyncCallbacks=[];u=r.isEqual;r.isEqual=function(n,t){var i=this;return Ext.isArray(n)&&Ext.isArray(t)?Ext.Array.equals(n,t):u.apply(i,arguments)};r._suppressValidityReset++;r.callParent(arguments);r.initFields(i?i.eagerNetsedInstantiation:!1);r.initMetaData();r.initBusinessRules();r.initValidationModel();r._suppressValidityReset--;r.join({afterEdit:function(){var n=Array.prototype.slice.call(arguments,0);n.shift();r.afterEdit.apply(r,n)}});i&&i.applyNested&&r.loadData(f)},getFieldsDescription:function(){var n=this;return n._fields},getMetaDataNames:function(){var n=this;return n._metaModel.getMetaDataNames()},initFields:function(n){var t=this;t._fields=[];Ext.Array.forEach(t.fields,function(n){n.name==="meta"||n.reference||t._fields.push(n)});Ext.Object.eachValue(t.associations,function(i){var e=i.association.isOneToOne?!i.left:i.left,f=i.association.field||i.field,r,u;f&&e&&i.role!=="meta"&&(r={name:i.role,schemaRole:i},Ext.isObject(f)&&(r=Ext.apply(r,f)),r.instance=Ext.bind(t[i.getterName],t),i.association.isOneToOne?(n&&(t[i.setterName].call(t,new i.cls),t.subscribeNestedModel(r.instance(),r.name)),r.isModelField=!0):(u=r.instance(),Ext.ux.data.AsyncStore.decorate(u),t.subscribeNestedStore(u,r.name),r.isStoreField=!0,u.applyModelConfig({validateOnChange:t.validateOnChange,validateOnMetaDataChange:t.validateOnMetaDataChange})),t._fields.push(r))})},initMetaData:function(){var n=this;n._metaModel=Ext.ux.data.MetaModel.createMetaModel(n);n._metaModel.join({onMetaDataChanged:function(t,i,r,u){Ext.Array.each(r,function(t){n.onMetaDataChange(i,t,u.get(t))})}});n.setMeta(n._metaModel)},initValidationModel:function(){var n=this,t;n._metaDataValidatorsMap=Ext.apply({},MetaDataValidatorMapper.getValidatorsMap(),n.metaDataValidatorsMap);n._metaDataValidatorsMap=Ext.applyIf(n._metaDataValidatorsMap,n._defaultMetaDataValidatorsMap);Ext.Object.each(n._metaDataValidatorsMap,function(n,t){t.activationRule=t.activationRule||function(t,i){return!!t.getMetaValue(i,n)}});t=JSON.stringify({});n._validationModel={};n._validationRules={};Ext.Array.forEach(n._fields,function(i){n._validationModel[i.name]={isValidated:!0,isValidating:!1,lastValidatingOptions:t,fieldState:0,callbacks:[],lastValidValue:null};n._validationRules[i.name]=n.createValidationRule(i.name)})},initBusinessRules:function(){var n=this;n._businessRuleCompletedCallback=Ext.bind(n.onBusinessRuleCompleted,n);n._businessRules={};Ext.Array.forEach(n._fields,function(t){var u=t.name+"Change",f=n.businessRules[u],i,r;f&&(n._businessRules[u]=n.createAsyncRule(f,t.name,n.defaultBusinessService));i=t.name+"ValidChange";r=n.businessRules[i];r&&(n._businessRules[i]=n.createAsyncRule(r,t.name,n.defaultBusinessService))})},syncWithBusinessRules:function(n){var t=this;t._businessRulesSyncCounter+=t._fields.length;Ext.Array.forEach(t._fields,function(n){(n.isStoreField||n.isModelField)&&n.instance()?n.instance().syncWithBusinessRules(t._businessRuleCompletedCallback):t._businessRulesSyncCounter--});t._businessRulesSyncCounter===0?n():t._businessLogicSyncCallbacks.push(n)},loadData:function(n){var t=this;t.syncWithBusinessRules(function(){t.resetValidation();t._suppressValidityReset++;t._suppressBusinessLogic++;t.resetMetaData();t.clearAllFields();t.beginEdit();Ext.Array.forEach(t._fields,function(i){i.isStoreField||i.isModelField?n[i.name]&&i.instance()&&i.instance().loadData(n[i.name]):t.set(i.name,n[i.name])});t.endEdit();t.commit(!0);t._suppressBusinessLogic--;t._suppressValidityReset--;t.onLoad()})},runBusinessLogic:function(n,t){var i=this;t?i.syncWithBusinessRules(function(){i._businessRulesSyncCounter++;n(i._businessRuleCompletedCallback)}):(i._businessRulesSyncCounter++,n(i._businessRuleCompletedCallback))},clear:function(n){var t=this;t.syncWithBusinessRules(function(){t.resetValidation();t.resetMetaData();t._suppressValidityReset++;t._suppressBusinessLogic++;t.clearAllFields(n);t.onClear();t._suppressBusinessLogic--;t._suppressValidityReset--})},validate:function(n,t){var i=this;(n=n||{},t&&i._validationCallbacks.push(t),i.isValidating)||(i.isValidating=!0,i.syncWithBusinessRules(function(){var t=[],r=[],u=i.getNumOfFields(),f=function(f,e){if(t=t.concat(f),r=r.concat(e),u--,u===0)if(i.isValidating=!1,i.isValidated())i.onModelValidated(t,r);else i.validate(n)};if(Ext.isFunction(i.onValidate)){u++;i.onValidate(n,function(n,t){i._errorMessage=n;i._infoMessage=t;f([n],[t])})}Ext.Array.forEach(i._fields,function(t){i.validateField(t.name,n,f);(t.isStoreField||t.isModelField)&&t.instance()&&t.instance().validate(n,f)})}))},validateField:function(n,t,i){var r=this;t=t||{};r.performValidation(n,t,i)},resetValidation:function(){var n=this;n._errorMessage="";n._infoMessage="";Ext.Array.forEach(n._fields,function(t){n.resetFieldValidation(t.name);(t.isStoreField||t.isModelField)&&t.instance()&&t.instance().resetValidation()});Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},isValidated:function(){var t=this,n;return t.isValidating?!1:(n=!0,Ext.Array.each(t._fields,function(i){var r=t._validationModel[i.name];return n=r.isValidated,n&&(i.isStoreField||i.isModelField)&&i.instance()&&(n=i.instance().isValidated()),n?void 0:!1}),n)},isValid:function(){var t=this,n=!t._errorMessage;return n&&Ext.Array.each(t._fields,function(i){return n=!t.getMetaValue(i.name,"validationErrorMessages").length,n&&(i.isStoreField||i.isModelField)&&i.instance()&&(n=i.instance().isValid()),n?void 0:!1}),n},setMetaValue:function(n,t,i){var r=this;(t==="validationErrorMessages"||t==="validationInfoMessages")&&Ext.Error.raise('Direct set of "validationErrorMessages" or "validationInfoMessages" is forbidden');r.setMetaInternal(n,t,i)},getMetaValue:function(n,t){var i=this;return i._metaModel.getMeta(n,t)},resetMetaData:function(){var n=this;n._metaModel.reset()},getFieldValidationInfo:function(n){var t=this,i,r;return n!==t.idProperty?(i=t.getField(n),r=t._validationModel[n],{isValidated:r.isValidated,isValidating:r.isValidating,validationErrorMessages:t.getMetaValue(n,"validationErrorMessages"),validationInfoMessages:t.getMetaValue(n,"validationInfoMessages"),subInfo:(i.isStoreField||i.isModelField)&&i.instance()?i.instance().getAllValidationInfo():null}):null},getAllValidationInfo:function(){var n=this,t={};return Ext.Object.each(n._validationModel,function(i){t[i]=n.getFieldValidationInfo(i)}),t},onModelValidated:function(n,t){var i=this;Ext.each(i._validationCallbacks,function(i){i(n,t)});Ext.Array.erase(i._validationCallbacks,0,i._validationCallbacks.length)},onFieldValidated:function(n){var t=this,i=t._validationModel[n],r,u;if(i.isValidating=!1,i.isValidated=!0,t.executeFieldValidationCallbacks(n),r=t.getMetaValue(n,"validationErrorMessages"),u=t.getMetaValue(n,"validationInfoMessages"),t.fireEvent("validated",t,n,r,u),t.afterValidated([n]),!r.length&&!t._suppressValidChangeEvent&&!t.isEqual(i.lastValidValue,t.get(n))){i.lastValidValue=t.get(n);t.onValidChange(n)}},onValidChange:function(n){var t=this;t._suppressBusinessLogic||t.runBusinessRule(n,"ValidChange");t.fireEvent("validchange",t,n);t.afterValidChange([n])},onLoad:Ext.emptyFn,onClear:Ext.emptyFn,onModelChange:function(n){var t=this;Ext.each(n,function(n){t._suppressBusinessLogic||t.runBusinessRule(n,"Change")});t._suppressChangeEvent||t.fireChangeEvent(n);t._suppressValidityReset||t.resetValidity(n)},onMetaDataChange:function(n,t,i){var r=this;r.fireEvent("metadatachange",r,n,t,i);!r._suppressValidityReset&&r.validateOnMetaDataChange&&t!=="validationErrorMessages"&&t!=="validationInfoMessages"&&r.resetFieldValidity(n);r.afterMetaDataChange([n])},onBusinessRuleCompleted:function(){var n=this;n._businessRulesSyncCounter--;n._businessRulesSyncCounter===0&&n.onBusinessLogicCompleted()},onBusinessLogicCompleted:function(){var n=this;Ext.each(n._businessLogicSyncCallbacks,function(n){n()});Ext.Array.erase(n._businessLogicSyncCallbacks,0,n._businessLogicSyncCallbacks.length)},endEdit:function(n,t){var i=this;t||(t=i.getModifiedFieldNames(),t=t.concat(i._modifiedNestedFieldNames));i.callParent([n,t]);i._modifiedNestedFieldNames=[]},cancelEdit:function(){var n=this;n._modifiedNestedFieldNames=[];n.callParent(arguments)},afterEdit:function(n){var t=this;t.onModelChange(n)},getRawData:function(n){var t=this,i;return n=n||{},i=t.getData(),Ext.Array.forEach(t._fields,function(r){(n.includeViewFields||!t.getMetaValue(r.name,"viewField"))&&(r.isStoreField||r.isModelField)&&r.instance()&&(i[r.name]=r.instance().getRawData())}),i},reject:function(n){var t=this,i,r=t.modified,u=[];for(i in r)r.hasOwnProperty(i)&&typeof r[i]!="function"&&u.push(i);if(t.callParent(arguments),n&&t._suppressChangeEvent++,u.length)t.onModelChange(u);n&&t._suppressChangeEvent--},set:function(n,t,i){var r=this;i&&r._suppressChangeEvent++;r.callParent(arguments);i&&r._suppressChangeEvent--},afterValidated:function(n){var t=this;t.callJoined("afterValidated",n)},afterValidChange:function(n){var t=this;t.callJoined("afterValidChange",n)},resetFieldValidation:function(n){var t=this,i=t._validationModel[n];Ext.Array.erase(i.callbacks,0,i.callbacks.length);t._suppressValidChangeEvent=!0;t.resetValidationMessages(n);t.onFieldValidated(n);t._suppressValidChangeEvent=!1},getFieldValue:function(n){var i=this,t=Ext.Array.findBy(i._fields,function(t){return t.name===n});return t&&(t.isStoreField||t.isModelField)?t.instance():i.get(n)},performValidation:function(n,t,i){var u=this,r=u._validationModel[n],h=u.getFieldValue(n),f=JSON.stringify(t),s=r.fieldState,e=f!==r.lastValidatingOptions||s!==r.fieldState,o;if(e&&(r.lastValidatingOptions=f),o=u._validationRules[n],i&&r.callbacks.push(i),!r.isValidating||e)if(r.isValidating=!0,r.isValidated&&!e)r.isValidating=!1,u.executeFieldValidationCallbacks(n);else if(o)o.call(u,h,t,function(t,i){if(s===r.fieldState&&r.lastValidatingOptions===f){u.setValidationMessages(n,t,i);u.onFieldValidated(n)}});else{u.resetValidationMessages(n);u.onFieldValidated(n)}},executeFieldValidationCallbacks:function(n){var t=this,i=t._validationModel[n];Ext.each(i.callbacks,function(i){i(t.getMetaValue(n,"validationErrorMessages"),t.getMetaValue(n,"validationInfoMessages"))});Ext.Array.erase(i.callbacks,0,i.callbacks.length)},resetValidity:function(n){var t=this;t.validateOnChange&&Ext.each(n,function(n){n!==t.idProperty&&t.resetFieldValidity(n)})},resetFieldValidity:function(n){var i=this,t;i.validateOnChange&&(t=i._validationModel[n],t.fieldState++,t.isValidated=!1,t.isValidating=!1,i.validateField(n,null))},afterMetaDataChange:function(n){var t=this;t.callJoined("afterMetaDataChange",n)},runBusinessRule:function(n,t){var i=this,r=n+t;i._businessRules[r]&&(i._businessRulesSyncCounter++,i._businessRules[r](i.get(n),i._businessRuleCompletedCallback))},tryCreateStandardValidator:function(n){var i=this,t=null;return(Ext.isString(n)&&n.indexOf(".")===-1||Ext.isObject(n))&&(t=i.createStandardValidator(n)),t},createMappedValidators:function(n){var t=this,i=[],r=t.getField(n);return Ext.Array.forEach(t.getMetaDataNames(),function(n){if(t._metaDataValidatorsMap[n]){var u=t.createMappedValidator(r,t._metaDataValidatorsMap[n]);i.push(u)}}),i},createMappedValidator:function(n,t){var u=this,i=t.config,r,f,e;return i=Ext.isString(i)?{type:i}:Ext.apply({},i),i.fieldName=n.name,r=t.fieldConfigReplications,r&&Ext.Array.each(r,function(t){n[t]!==undefined&&(i[t]=n[t])}),f=t.activationRule,e=u.createStandardValidator(i),function(){return f(u,n.name)?e.apply(window,arguments):{errorMessage:"",infoMessage:""}}},createStandardValidator:function(n){var i=this,t=Ext.Factory.dataValidator(n),r=null;return r=t instanceof Ext.data.validator.ParametrizedValidator?Ext.bind(t.validateWithOptions,t):function(n,i){return t.validate(n,i)},function(n,u){var f=r(n,i,u),e="";return f!==!0&&(e=Ext.isString(f)&&f?f:i.defaultFieldErrorMessage),{errorMessage:e,infoMessage:t.getInfoMessage?t.getInfoMessage()||"":""}}},createValidationRule:function(n){var t=this,u=Ext.Array.from(t.validationRules[n]),r=t.createMappedValidators(n),i=[];return(Ext.Array.each(u,function(u){var f=t.tryCreateStandardValidator(u);f?r.push(f):i.push(t.createAsyncRule(u,n,t.defaultValidationService))}),!i.length&&!r.length)?null:function(n,u,f){var e=[],o=[],s,h;Ext.Array.each(r,function(t){var i=t(n,u);i.errorMessage&&e.push(i.errorMessage);i.infoMessage&&o.push(i.infoMessage)});!e.length&&i.length?(s=i.length,h=function(n,t){s--;n&&e.push(n);t&&o.push(t);s||f(e,o)},Ext.Array.each(i,function(i){i.call(t,n,u,h)})):f(e,o)}},createAsyncRule:function(n,t,i){var r=this,u={fieldName:t},s,f,h;if(Ext.isObject(n)&&(Ext.apply(u,n),n=n.descriptor,delete u.descriptor),Ext.isFunction(n))s=n,f=r,h=[u];else{var e=i,o=n,c=n.split(".");c.length===2&&(e=c[0],o=c[1]);e==="this"?(r[o]||Ext.Error.raise(o+" is not defined"),s=r[o],f=r,h=[u]):(f=Deft.Injector.canResolve(e)?Deft.Injector.resolve(e):r[e],s=f[o],h=[r,u])}return Ext.bind(s,f,h,0)},clearAllFields:function(n){var t=this;t.beginEdit();Ext.Array.forEach(t._fields,function(i){n&&Ext.Array.contains(n,i.name)||t.clearField(i.name)});t.endEdit()},clearField:function(n){var f=this,u=f.getField(n),t=f.getFieldValue(n),e=u.useNull,r=u.defaultValue,i=null;if(u.isModelField||u.isStoreField){t&&t.clear();return}Ext.isString(t)?i=r||"":Ext.isArray(t)?i=r||[]:Ext.isNumber(t)?i=r||(e?null:0):Ext.isBoolean(t)?i=r||(e?null:!1):Ext.isDate(t)&&(i=r||(e?null:""));f.set(n,i)},getNumOfFields:function(){var n=this;return n._fields.length},fireChangeEvent:function(n){var t=this,i=Ext.Array.remove(Ext.Array.clone(n),t._ignoredFieldNames);t._ignoredFieldNames.concat(i);t.fireEvent("change",t,i);Ext.Array.remove(t._ignoredFieldNames,i)},subscribeNestedModel:function(n,t){var i=this;n.on("change",i.onNestedModelChange,i,{fieldName:t})},onNestedModelChange:function(n,t,i){var r=this;r.editing?r._modifiedNestedFieldNames.push(i.fieldName):r.afterEdit([i.fieldName])},subscribeNestedStore:function(n,t){var i=this;n.on("datachanged",i.onNestedStoreChange,i,{fieldName:t});n.on("update",i.onNestedStoreUpdate,i,{fieldName:t})},onNestedStoreUpdate:function(n,t,i,r,u,f){var e=this;switch(i){case Ext.data.Model.EDIT:case Ext.data.Model.REJECT:e.editing?e._modifiedNestedFieldNames.push(f.fieldName):e.afterEdit([f.fieldName])}},setValidationMessages:function(n,t,i){var r=this;r.setMetaInternal(n,"validationInfoMessages",i||[],!0);r.setMetaInternal(n,"validationErrorMessages",t||[],!0)},resetValidationMessages:function(n){var t=this;t.setMetaInternal(n,"validationInfoMessages",[],!0);t.setMetaInternal(n,"validationErrorMessages",[],!0)},setMetaInternal:function(n,t,i,r){var u=this;r&&u._suppressValidityReset++;u._metaModel.setMeta(n,t,i);r&&u._suppressValidityReset--},onNestedStoreChange:function(n,t){var i=this;i.editing?i._modifiedNestedFieldNames.push(t.fieldName):i.afterEdit([t.fieldName])},getField:function(n){var t=this;return Ext.Array.findBy(t._fields,function(t){return t.name===n})},getStuckValidations:function(){var t=this,n=[];return Ext.Object.each(t._validationModel,function(t,i){i.callbacks.length&&n.push(t)}),n},statics:{initValidationRules:function(n,t,i){var r={},u,f;i._validationRules&&(u=i._validationRules,delete i._validationRules,r=Ext.merge(r,u));n._validationRules&&(f=n._validationRules,delete n._validationRules,r=Ext.merge(r,f));t._validationRules=i._validationRules=r},initBusinessRules:function(n,t,i){var r={},u,f;i._businessRules&&(u=i._businessRules,delete i._businessRules,r=Ext.merge(r,u));n._businessRules&&(f=n._businessRules,delete n._businessRules,r=Ext.merge(r,f));t._businessRules=i._businessRules=r},initMetaDataValidatorsMap:function(n,t,i){var r={},u,f;i._metaDataValidatorsMap&&(u=i._metaDataValidatorsMap,delete i._metaDataValidatorsMap,r=Ext.merge(r,u));n._metaDataValidatorsMap&&(f=n._metaDataValidatorsMap,delete n._metaDataValidatorsMap,r=Ext.merge(r,f));t._metaDataValidatorsMap=i._metaDataValidatorsMap=r}}},function(){var n=this;n.onExtended(function(t,i){var r=t.prototype;n.initValidationRules(i,t,r);n.initBusinessRules(i,t,r);n.initMetaDataValidatorsMap(i,t,r)})});Ext.data.Model.addStatics({METACHANGE:"metachange",VALIDCHANGE:"validchange",VALIDATED:"validated"});Ext.define("Ext.ux.data.AsyncStore",{statics:{decorate:function(n){Ext.override(n,{isAsyncStore:!0,_validationCallbacks:[],_businessLogicSyncCallbacks:[],applyModelConfig:function(n){var t=this;t._modelConfig=n;t.each(function(t){Ext.apply(t,n)})},syncWithBusinessRules:function(n){var t=this,i;t.businessRulesSyncCounter=t.count();i=function(){t.onRecordBusinessLogicCompleted()};t.each(function(n){n.syncWithBusinessRules(i)});t.businessRulesSyncCounter===0?Ext.callback(n):t._businessLogicSyncCallbacks.push(n)},getRawData:function(n){var i=this,t=[];return i.each(function(i){t.push(i.getRawData(n))}),t},clear:function(){var n=this;n.removeAll();Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},validate:function(n,t){var i=this;if(t&&i._validationCallbacks.push(t),!i.isValidating){var f=i.count(),r=[],u=[],e=function(t,e){if(r=r.concat(t),u=u.concat(e),f--,f===0)if(i.isValidating=!1,i.isValidated())i.onStoreValidated(r,u);else i.validate(n)};if(f)i.isValidating=!0,i.each(function(t){t.validate(n,e)});else i.onStoreValidated(r,u)}},resetMetaData:function(){var n=this;n.each(function(n){n.resetMetaData()})},resetValidation:function(){var n=this;n.each(function(n){n.resetValidation()});Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},isValidated:function(){var t=this,n=!0;return t.each(function(t){return n=t.isValidated(),n?void 0:!1}),n},isValid:function(){var t=this,n=!0;return t.each(function(t){return n=t.isValid(),n?void 0:!1}),n},getAllValidationInfo:function(){var t=this,n=[];return t.each(function(t){n.push(t.getAllValidationInfo())}),n},onRecordBusinessLogicCompleted:function(){var n=this;n.businessRulesSyncCounter--;n.businessRulesSyncCounter===0&&n.onBusinessLogicCompleted()},onBusinessLogicCompleted:function(){var n=this;Ext.each(n._businessLogicSyncCallbacks,function(n){Ext.callback(n)});Ext.Array.erase(n._businessLogicSyncCallbacks,0,n._businessLogicSyncCallbacks.length)},onStoreValidated:function(n,t){var i=this;Ext.each(i._validationCallbacks,function(i){i(n,t)});Ext.Array.erase(i._validationCallbacks,0,i._validationCallbacks.length)},createModel:function(){var n=this,t=n.callParent(arguments);return n._modelConfig&&Ext.apply(t,n._modelConfig),t},afterMetaDataChange:function(n,t){this.getData().itemChanged(n,t||null,undefined,Ext.data.Model.METACHANGE)},afterValidChange:function(n,t){this.getData().itemChanged(n,t||null,undefined,Ext.data.Model.VALIDCHANGE)}})}}});
//# sourceMappingURL=ext-asyncmodel-all.min.js.map
