Ext.defineInterface("IGridMetaDataBinder",{inherit:"ISingleton",methods:["onInit","onDestroy","onRender"]});Ext.defineInterface("IMetaDataBinder",{inherit:"ISingleton",methods:["getMetaDataName","isApplicable","onComponentBound","onComponentUnbound","applyMetaData"]});Ext.define("Ext.ux.binder.AbstractFormFieldBinder",{implement:"IMetaDataBinder",abstractClass:!0,getMetaDataName:function(){return this.metaDataName||Ext.Error.raise("metaDataName not defined"),this.metaDataName},onComponentBound:function(){},onComponentUnbound:function(){},isApplicable:function(n){return n.isFormField},applyMetaData:function(){},applyPlugin:function(n,t){n.findPlugin(t)||n.addPlugin(t)}});Ext.define("Ext.ux.binder.FormFieldReadOnlyBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",metaDataName:"readOnly",onComponentBound:function(n){this.applyPlugin(n,"readonlylatching")},applyMetaData:function(n,t){t?n.latchReadOnly():n.unlatchReadOnly()}});Ext.define("Ext.ux.binder.FormFieldRequiredBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",requiredClassName:"requiredField",metaDataName:"required",applyMetaData:function(n,t){var r=this,i=n.requiredClassName===undefined?r.requiredClassName:n.requiredClassName;t?n.addCls(i):n.removeCls(i)}});Ext.define("Ext.ux.binder.FormFieldValidationBinder",{extend:"Ext.ux.binder.AbstractFormFieldBinder",metaDataName:"validationErrorMessages",onComponentBound:function(n){this.applyPlugin(n,"externalvalidating")},applyMetaData:function(n,t){n.setExternalErrors("modelValidation",t)}});Ext.define("Ext.ux.binder.GridReadOnlyBinder",{implement:"IGridMetaDataBinder",onInit:function(n){var t=this;n.on("beforeedit",t.onBeforeCellEdit)},onDestroy:function(n){var t=this;n.un("beforeedit",t.onBeforeCellEdit)},onRender:function(){},onBeforeCellEdit:function(n,t){return!t.record.getMeta(t.column.dataIndex,"readOnly")}});Ext.define("Ext.ux.binder.GridRequiredBinder",{implement:"IGridMetaDataBinder",requiredCellCls:"requiredGridCell",onInit:function(){},onDestroy:function(){},onRender:function(n,t){var i=n.column.dataIndex;t.getMeta(i,"required")&&(n.tdCls+=" "+this.requiredCellCls)}});Ext.define("Ext.ux.binder.GridValidationBinder",{implement:"IGridMetaDataBinder",invalidCellCls:"invalidGridCell",onInit:function(){},onDestroy:function(){},onRender:function(n,t){var r=n.column.dataIndex,i=t.getMeta(r,"validationErrorMessages");i.length?(n.tdCls+=" "+this.invalidCellCls,n.tdAttr='data-errorqtip="'+i.join("<\/br>")+'"'):n.tdAttr='data-errorqtip=""'}});Ext.define("Ext.ux.mixin.Bindable",{isBindable:!0,bindModel:function(){Ext.Error.raise("Ext.ux.mixin.Bindable.bindModel method is not implemented")},clearModelBinding:function(){Ext.Error.raise("Ext.ux.mixin.Bindable.clearModelBinding method is not implemented")}});Ext.define("Ext.ux.plugin.DataBinding",{alias:"plugin.databinding",extend:"Ext.AbstractPlugin",inject:{metaDataBinders:"IMetaDataBinder[]"},_rootModelIndex:"__root__",constructor:function(){var n=this;n._formFieldsMap=new Ext.ux.util.Lookup;n._bindableControlsMap=new Ext.ux.util.Lookup;n._metaDataBinders=Ext.ux.util.Lookup.fromArray(n.metaDataBinders,function(n){return n.getMetaDataName()});n._subscribedModels={};n._modelFieldsMap={};n.callParent(arguments)},init:function(n){var t=this;t._owner=n;t._formFields=new DynamicComponentQuery(t._owner,"[isFormField][name]:not([excludeForm]), [isFormField][dataField]:not([excludeForm])","[isBindable] [isFormField], [isFormField] [isFormField]");t._bindableControls=new DynamicComponentQuery(t._owner,"[isBindable][dataField]","[isBindable]:not([dataField]) [isBindable]");t._formFields.on("componentsadd",t.onFormFieldsAdded,t);t._formFields.on("componentsremove",t.onFormFieldsRemoved,t);t._bindableControls.on("componentsadd",t.onBindableControlsAdded,t);t._bindableControls.on("componentsremove",t.onBindableControlsRemoved,t);t.applyBindableInterfaceToOwner()},applyBindableInterfaceToOwner:function(){var n=this;Ext.apply(n._owner,{bindModel:function(t){t instanceof Ext.ux.data.AsyncModel||Ext.Error.raise(n._owner.$className+'.bindModel method accepts only "Ext.ux.data.AsyncModel" type');this.clearModelBinding();n.bindModel(t)},clearModelBinding:function(){n.clearBinding()},isBindable:!0})},onFormFieldBound:function(){},onFormFieldUnbound:function(){},onBindableControlBound:function(){},onBindableControlUnbound:function(){},bindModel:function(n){var t=this;t._model=n;t.bindFormFields();t.bindBindableControls();t._owner.fireEvent("modelbound",t._owner,t._model)},clearBinding:function(){var n=this,t;n._model&&(n.unbindFormFields(),n.unbindBindableControls(),t=n._model,delete n._model,n._owner.fireEvent("modelunbound",n._owner,t))},bindFormFields:function(){var n=this;n._formFields.each(function(t){n.bindFormField(t)})},unbindFormFields:function(){var n=this;n._formFieldsMap.clone().each(function(t){n.unbindFormField(t.formField)})},onFormFieldsAdded:function(n){var t=this;t._model&&Ext.Array.each(n,function(n){t.bindFormField(n)})},onFormFieldsRemoved:function(n){var t=this;t._model&&Ext.Array.each(n,function(n){t.unbindFormField(n)})},bindFormField:function(n){var i=this,t,f;if(n.dataField=n.dataField||n.name,t=i.getFieldModel(n.dataField),t){var u=n.dataField.split("."),e=u.length>1?u.slice(0,u.length-1).join("."):"",o=e||i._rootModelIndex,r=u[u.length-1];n.setValue(t.get(r));i.subscribeFormField(n);i._subscribedModels[o]||(i.subscribeModel(t,e),i._subscribedModels[o]=t);f=i.getMetaDataBindersMap(t,n);i._formFieldsMap.add(n.dataField,{formField:n,metaDataBindersMap:f});i._modelFieldsMap[n.dataField]={model:t,modelFieldName:r};Ext.Object.each(f,function(i,u){u.onComponentBound(n,t,r);u.applyMetaData(n,t.getMeta(r,i),t,r)});i.onFormFieldBound(n,t,r)}},unbindFormField:function(n){var t=this,r=t._formFieldsMap.find(n.dataField,function(t){return t.formField===n}),e,o;if(r){t.unsubscribeFormField(n);t._formFieldsMap.remove(n.dataField,r);var u=t._modelFieldsMap[n.dataField].model,i=n.dataField.split("."),f=i[i.length-1];t._formFieldsMap.get(n.dataField).length||(e=i.length>1?i.slice(0,i.length-1).join("."):"",o=e||t._rootModelIndex,t.unsubscribeModel(u),delete t._subscribedModels[o],delete t._modelFieldsMap[n.dataField]);Ext.Object.eachValue(r.metaDataBindersMap,function(t){t.onComponentUnbound(n,u,f)});t.onFormFieldUnbound(n,u,f)}},subscribeModel:function(n,t){var i=this;n.on("metadatachange",i.onModelMetaDataChanged,i,{modelPath:t});n.on("change",i.onModelChanged,i,{modelPath:t})},unsubscribeModel:function(n){var t=this;n.un("metadatachange",t.onModelMetaDataChanged,t);n.un("change",t.onModelChanged,t)},subscribeFormField:function(n){var t=this;if(n.modelUpdateMode==="onChange")n.on("change",t.onFormFieldChange,t);else{n.on("change",t.onFormFieldChange,t);n.on("blur",t.onFormFieldBlur,t)}},unsubscribeFormField:function(n){var t=this;n.un("change",t.onFormFieldChange,t);n.un("blur",t.onFormFieldBlur,t)},bindBindableControls:function(){var n=this;n._bindableControls.each(function(t){n.bindBindableControl(t)})},unbindBindableControls:function(){var n=this;n._bindableControlsMap.clone().each(function(t){n.unbindBindableControl(t.control)})},onBindableControlsAdded:function(n){var t=this;t._model&&Ext.Array.each(n,function(n){t.bindBindableControl(n)})},onBindableControlsRemoved:function(n){var t=this;t._model&&Ext.Array.each(n,function(n){t.unbindBindableControl(n)})},bindBindableControl:function(n){var r=this,t=r.getFieldModel(n.dataField),u,i,f;if(t){u=n.dataField.split(".");i=u[u.length-1];n.bindModel(t.get(i));f=r.getMetaDataBindersMap(t,n);r._bindableControlsMap.add(n.dataField,{control:n,metaDataBindersMap:f});r._modelFieldsMap[n.dataField]={model:t,modelFieldName:i};Ext.Object.each(f,function(r,u){u.onComponentBound(n,t,i);u.applyMetaData(n,t.getMeta(i,r),t,i)});r.onBindableControlBound(n,t,i)}},unbindBindableControl:function(n){var t=this,i=t._bindableControlsMap.find(n.dataField,function(t){return t.control===n});if(i){n.clearModelBinding();t._bindableControlsMap.remove(n.dataField,n);var r=t._modelFieldsMap[n.dataField].model,u=n.dataField.split("."),f=u[u.length-1];t._bindableControlsMap.get(n.dataField).length||delete t._modelFieldsMap[n.dataField];Ext.Object.eachValue(i.metaDataBindersMap,function(t){t.onComponentUnbound(n,r,f)});t.onBindableControlUnbound(n,r,f)}},onModelMetaDataChanged:function(n,t,i,r,u){var f=this,e=u.modelPath?u.modelPath+".":"";f.updateFormFieldsMetaData(e+t,i,r);f.updateBoundBindableControlsMetaData(e+t,i,r)},onModelChanged:function(n,t,i){var r=this,u=i.modelPath?i.modelPath+".":"";Ext.each(t,function(t){r.updateFormFieldsValue(u+t,n.get(t))})},onFormFieldChange:function(n){var t=this;if(n.modelUpdateMode==="onBlur"){n.hasFocus||t.applyFormFieldChange(n);return}t.applyFormFieldChange(n)},onFormFieldBlur:function(n){var t=this;t.applyFormFieldChange(n)},updateFormFieldsMetaData:function(n,t,i){var u=this,r;i!==undefined&&(r=u._modelFieldsMap[n],u._formFieldsMap.eachForKey(n,function(n){var u=n.metaDataBindersMap[t];u&&u.applyMetaData(n.formField,i,r.model,r.modelFieldName)}))},updateBoundBindableControlsMetaData:function(n,t,i){var u=this,r;i!==undefined&&(r=u._modelFieldsMap[n],u._bindableControlsMap.eachForKey(n,function(n){var u=n.metaDataBindersMap[t];u&&u.applyMetaData(n.formField,i,r.model,r.modelFieldName)}))},getMetaDataBindersMap:function(n,t){var r=this,u=n.getMetaDataNames(),i={};return Ext.Array.each(u,function(n){var u=r.getMetaDataBinder(t,n);u&&(i[n]=u)}),i},getMetaDataBinder:function(n,t){var u=this,i,r=0;return u._metaDataBinders.eachForKey(t,function(t){var u=t.isApplicable(n);u=u===!0?1:Ext.isNumber(u)?u:0;u>r&&(i=t,r=u)}),i},applyFormFieldChange:function(n){var t=this,i;n.dataField!==t._ignoredModelFieldPath&&(t.ignoredFormField=n,i=t._modelFieldsMap[n.dataField],i.model.set(i.modelFieldName,n.getValue()),t.ignoredFormField=null)},updateFormFieldsValue:function(n,t){var i=this;i._ignoredModelFieldPath=n;i._formFieldsMap.eachForKey(n,function(n){n.formField!==i.ignoredFormField&&n.formField.setValue(t)});i._ignoredModelFieldPath=""},getFieldModel:function(n){for(var u,f,e=this,i=n.split("."),t=e._model,o=i.length-1,s=i[i.length-1],r=0;r<o;r++)t=t.get(i[r]);return u=t instanceof Ext.ux.data.AsyncModel?Ext.getClass(t).getFields():[],f=Ext.Array.some(u,function(n){return n.name===s}),f?t:null}});Ext.define("Ext.ux.plugin.GridDataBinding",{alias:"plugin.griddatabinding",extend:"Ext.ux.plugin.DataBinding",inject:{gridMetaDataBinders:"IGridMetaDataBinder[]"},mixins:["Ext.util.Observable"],init:function(n){var t=this;t.mixins.observable.constructor.call(t);n.findPlugin("gridstorereconfiguring")||n.addPlugin("gridstorereconfiguring");t.callParent(arguments)},initBinders:function(){var n=this;n._bindersInitialized||(n.overrideColumnRenderers(),n.overrideGridViewOnUpdate(n._owner),n.mon(n._owner,{reconfigure:{fn:n.onReconfigure,scope:n}}),Ext.Array.each(n.gridMetaDataBinders,function(t){t.onInit(n._owner,n)}),n._bindersInitialized=!0)},destroy:function(){var n=this;n._bindersInitialized&&Ext.Array.each(n.gridMetaDataBinders,function(t){t.onDestroy(n._owner,n)})},applyBindableInterfaceToOwner:function(){var n=this;n.callParent(arguments);Ext.apply(n._owner,{bindModel:function(t){t instanceof Ext.ux.data.AsyncStore||t instanceof Ext.ux.data.AsyncModel||Ext.Error.raise(Ext.create("ArgumentTypeException",{msg:owner.$className+'.bindModel method accepts only "Ext.ux.data.AsyncStore" type'}));t instanceof Ext.ux.data.AsyncStore?(this.clearModelBinding(),n.bindStore(t)):(this.clearModelBinding(),n._owner.storeDataField&&n.bindStore(t.get(n._owner.storeDataField)),n.bindModel(t))}})},bindStore:function(n){var t=this;t.initBinders();t._store=n;t._originalStore=t._owner.store;t._storebinding=!0;t._owner.reconfigure(n);t._storebinding=!1;t._owner.fireEvent("storebound",t._owner,n)},clearBinding:function(){var n=this,t;n.callParent(arguments);n._store&&(n._storebinding=!0,n._owner.reconfigure(n._originalStore),n._storebinding=!1,t=n._store,n._store=null,n._originalStore=null,n._owner.fireEvent("storeunbound",n._owner,t))},getMetaDataMap:function(n){var i=n.columns,t=null;return Ext.each(i,function(n){n.metaDataIndex&&(t=t||{},t[n.metaDataIndex]||(t[n.metaDataIndex]=[]),t[n.metaDataIndex].push(n.dataIndex))}),t},onReconfigure:function(n,t,i){var r=this;i&&r.overrideColumnRenderers();t&&!r._storebinding&&Ext.Error.raise("Reconfiguring with store is forbidden for bindable grid")},overrideGridViewOnUpdate:function(n){var i=this,r=i.getMetaDataMap(n),t=n.getView(),u=t.onUpdate;t.onUpdate=r?function(n,f,e,o){e!==Ext.data.Model.VALIDCHANGE&&(e===Ext.data.Model.METACHANGE&&(arguments[3]=i.updateChangedFieldNames(o,r)),u.apply(t,arguments))}:function(n,i,r){r!==Ext.data.Model.VALIDCHANGE&&u.apply(t,arguments)}},updateChangedFieldNames:function(n,t){var i=Ext.Array.clone(n);return Ext.each(n,function(n){var r=t[n];r&&(i=i.concat(r))}),i},overrideColumnRenderers:function(){var n=this,t=n._owner.columns;Ext.each(t,function(t){var i=t.renderer,r;t.xtype!=="rownumberer"&&(r=i?function(t,r,u,f,e,o,s){return t=n.renderer(t,r,u,f,e,o,s),i.apply(this,[t,r,u,f,e,o,s])}:Ext.bind(n.renderer,n),Ext.apply(t,{renderer:r,hasCustomRenderer:!0}))})},renderer:function(n,t,i,r,u,f,e){var o=this,s=t.column.dataIndex;return s&&Ext.Array.each(o.gridMetaDataBinders,function(n){n.onRender(t,i,r,u,f,e)}),n}});Ext.override("Ext.data.validator.Bound",{autoTrim:!0,getValue:function(n){var i=this,t;return n instanceof Ext.data.Store?n.count():(t=String(n),i.autoTrim&&(t=Ext.String.trim(t)),t.length)},validateValue:function(n){var t=this;return n===undefined||n===null||!t.getValue(n)?this.getEmptyMessage():!0},validate:function(n){var t=this;return n instanceof Ext.data.Model?!0:t.callParent(arguments)}});Ext.define("Ext.ux.validator.MetaDataValidatorMapper",{alternateClassName:"MetaDataValidatorMapper",singleton:!0,constructor:function(){this.map={}},assosiate:function(n,t,i){this.map[n]={config:t,fieldConfigReplications:i}},getValidatorsMap:function(){return this.map}});Ext.define("Ext.data.validator.ParametrizedValidator",{extend:"Ext.data.validator.Validator",alias:"data.validator.baseparametrizedvalidator",_infoMessage:"",validateWithOptions:function(n,t){return this.validate(n,t)},getInfoMessage:function(){return this._infoMessage}});Ext.define("Ext.data.validator.Required",{extend:"Ext.data.validator.ParametrizedValidator",alias:"data.validator.required",type:"required",config:{autoTrim:!0,requiredMessage:"This is a required field"},getValue:function(n){var i=this,t;return n instanceof Ext.data.Store?n.count():(t=String(n),i.getAutoTrim()&&(t=Ext.String.trim(t)),t.length)},validate:function(n){var t=this;return n===undefined||n===null||!t.getValue(n)?t.getRequiredMessage():!0},validateWithOptions:function(n,t,i){var r=this;return i.validatePresence?r.callParent(arguments):!0}});Ext.define("Ext.ux.data.field.AsyncModel",{extend:"Ext.data.field.Field",alias:["data.field.asyncmodel"],isModelField:!0,convert:function(n,t){var i=t.get(this.name);return!i&&!n&&this.lazy?null:(i&&i instanceof Ext.ux.data.AsyncModel||(this.model||Ext.Error.raise("'model'  must be defined for field with type 'asyncmodel'"),Ext.ClassManager.get(this.model).prototype instanceof Ext.data.Model||Ext.Error.raise("Field with type 'asyncmodel' accepts only 'Ext.ux.data.AsyncModel' types of models"),i=Ext.create(this.model)),n&&i.set(n),i)},getType:function(){return"model"}});Ext.define("Ext.ux.data.field.AsyncStore",{extend:"Ext.data.field.Field",alias:["data.field.asyncstore"],isStoreField:!0,convert:function(n,t){var i=t.get(this.name);return!i&&!n&&this.lazy?null:(i&&i instanceof Ext.ux.data.AsyncStore||(t instanceof Ext.ux.data.AsyncModel||Ext.Error.raise("Field with type 'asyncstore' can be used only for models of 'Ext.ux.data.AsyncModel' type"),!this.store||Ext.ClassManager.get(this.store).prototype instanceof Ext.ux.data.AsyncStore||Ext.Error.raise("Field with type 'asyncstore' accepts only 'Ext.ux.data.AsyncStore' types of stores"),!this.model||Ext.ClassManager.get(this.model).prototype instanceof Ext.ux.data.AsyncModel||Ext.Error.raise("Field with type 'asyncstore' accepts only 'Ext.ux.data.AsyncModel' types of models"),this.model||this.store||Ext.Error.raise("'model' or 'store' must be defined for field with type 'asyncstore'"),i=this.store?Ext.create(this.store):Ext.create("Ext.ux.data.AsyncStore",{model:this.model})),(n||i.count())&&i.loadData(n),i)},getType:function(){return"store"}});Ext.define("Ext.ux.data.AsyncModel",{extend:"Ext.data.Model",mixins:["Ext.util.Observable"],validateOnChange:!0,validateOnMetaDataChange:!1,defaultFieldErrorMessage:"Value is invalid",defaultModelErrorMessage:"Some fields have incorrect data",_businessRulesSyncCounter:0,_suppressBusinessLogic:0,_suppressValidityReset:0,_suppressValidChangeEvent:0,_suppressChangeEvent:0,_errorMessage:"",_infoMessage:"",_defaultProxy:{type:"memory"},_defaultMetaDataValidatorsMap:{required:{config:"required",fieldConfigReplications:["requiredMessage"]}},constructor:function(n){var t=this,i;t.mixins.observable.constructor.call(t);t.validationRules=t.validationRules||{};t.businessRules=t.businessRules||{};t.proxy=t.proxy||t._defaultProxy;t._ignoredFieldNames=[];t._modifiedNestedFieldNames=[];t._validationCallbacks=[];t._businessLogicSyncCallbacks=[];t._defaultMetaDataModel={required:!1,readOnly:!1,validationErrorMessages:[],validationInfoMessages:[]};i=t.isEqual;t.isEqual=function(n,t){var r=this;return Ext.isArray(n)&&Ext.isArray(t)?Ext.Array.equals(n,t):i.apply(r,arguments)};t._suppressValidityReset++;t.initMetaData();t.callParent(arguments);t.initBusinessRules();t.initFields();t.initValidationModel();t._suppressValidityReset--;t.join({afterEdit:function(){var n=Array.prototype.slice.call(arguments,0);n.shift();t.afterEdit.apply(t,n)}});n&&t.onLoad()},initFields:function(){var n=this,t=n.data;Ext.Array.forEach(n.fields,function(i){(i.isStoreField||i.isModelField)&&(t[i.name]||(t[i.name]=i.convert(null,n)),i.isModelField?(n.subscribeNestedModel(t[i.name],i.name),t[i.name].validateOnChange=n.validateOnChange,t[i.name].validateOnMetaDataChange=n.validateOnMetaDataChange):(n.subscribeNestedStore(t[i.name],i.name),t[i.name].applyModelConfig({validateOnChange:n.validateOnChange,validateOnMetaDataChange:n.validateOnMetaDataChange})))})},initMetaData:function(){var n=this;n._metaDataModel=Ext.apply({},n.metaDataModel,n._defaultMetaDataModel);n._metaData={};Ext.Array.forEach(n.fields,function(t){t.name!==n.idProperty&&(n._metaData[t.name]={},Ext.Object.each(n._metaDataModel,function(i,r){t[i]=t[i]||r;n._metaData[t.name][i]=t[i]||r}))})},initValidationModel:function(){var n=this,t;n._metaDataValidatorsMap=Ext.apply({},MetaDataValidatorMapper.getValidatorsMap(),n.metaDataValidatorsMap);n._metaDataValidatorsMap=Ext.applyIf(n._metaDataValidatorsMap,n._defaultMetaDataValidatorsMap);Ext.Object.each(n._metaDataValidatorsMap,function(n,t){t.activationRule=t.activationRule||function(t,i){return!!t.getMeta(i,n)}});t=JSON.stringify({});n._validationModel={};n._validationRules={};Ext.Array.forEach(n.fields,function(i){i.name!==n.idProperty&&(n._validationModel[i.name]={isValidated:!0,isValidating:!1,lastValidatingOptions:t,fieldState:0,callbacks:[],lastValidValue:null},n._validationRules[i.name]=n.createValidationRule(i.name))})},initBusinessRules:function(){var n=this;n._businessRuleCompletedCallback=Ext.bind(n.onBusinessRuleCompleted,n);n._businessRules={};Ext.Array.forEach(n.fields,function(t){var i,r,u,f;t.name!==n.idProperty&&(i=t.name+"Change",r=n.businessRules[i],r&&(n._businessRules[i]=n.createAsyncRule(r,n.defaultBusinessService)),u=t.name+"ValidChange",f=n.businessRules[u],f&&(n._businessRules[u]=n.createAsyncRule(f,n.defaultBusinessService)))})},getMetaDataNames:function(){var t=this,n=[];return Ext.Object.each(t._metaDataModel,function(t){n.push(t)}),n},syncWithBusinessRules:function(n){var t=this;t._businessRulesSyncCounter+=t.fields.length-1;Ext.Array.forEach(t.fields,function(n){n.name!==t.idProperty&&(n.isStoreField||n.isModelField?t.get(n.name).syncWithBusinessRules(t._businessRuleCompletedCallback):t._businessRulesSyncCounter--)});t._businessRulesSyncCounter===0?n():t._businessLogicSyncCallbacks.push(n)},loadData:function(n){var t=this;n&&t.syncWithBusinessRules(function(){t.resetValidation();t._suppressValidityReset++;t._suppressBusinessLogic++;t.resetMetaData();t.clearAllFields();t.beginEdit();Ext.Array.forEach(t.fields,function(i){i.isStoreField||i.isModelField?t.get(i.name).loadData(n[i.name]):t.set(i.name,n[i.name])});t.endEdit();t.commit(!0);t._suppressBusinessLogic--;t._suppressValidityReset--;t.onLoad()})},runBusinessLogic:function(n,t){var i=this;t?i.syncWithBusinessRules(function(){i._businessRulesSyncCounter++;n(i._businessRuleCompletedCallback)}):(i._businessRulesSyncCounter++,n(i._businessRuleCompletedCallback))},clear:function(n){var t=this;t.syncWithBusinessRules(function(){t.resetValidation();t.resetMetaData();t._suppressValidityReset++;t._suppressBusinessLogic++;t.clearAllFields(n);t.onClear();t._suppressBusinessLogic--;t._suppressValidityReset--})},validate:function(n,t){var i=this;(n=n||{},t&&i._validationCallbacks.push(t),i.isValidating)||(i.isValidating=!0,i.syncWithBusinessRules(function(){var t=[],r=[],u=i.getNumOfFields()+i.getNumOfComplexFields(),f=function(f,e){if(t=t.concat(f),r=r.concat(e),u--,u===0)if(i.isValidating=!1,i.isValidated())i.onModelValidated(t,r);else i.validate(n)};if(Ext.isFunction(i.onValidate)){u++;i.onValidate(n,function(n,t){i._errorMessage=n;i._infoMessage=t;f([n],[t])})}Ext.Array.forEach(i.fields,function(t){t.name!==i.idProperty&&(i.validateField(t.name,n,f),(t.isStoreField||t.isModelField)&&i.get(t.name).validate(n,f))})}))},validateField:function(n,t,i){var r=this;t=t||{};r.performValidation(n,t,i)},resetValidation:function(){var n=this;n._errorMessage="";n._infoMessage="";Ext.Array.forEach(n.fields,function(t){t.name!==n.idProperty&&(n.resetFieldValidation(t.name),(t.isStoreField||t.isModelField)&&n.get(t.name).resetValidation())});Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},isValidated:function(){var t=this,n;return t.isValidating?!1:(n=!0,Ext.Array.each(t.fields,function(i){if(i.name!==t.idProperty){var r=t._validationModel[i.name];return n=r.isValidated,n&&(i.isStoreField||i.isModelField)&&(n=t.get(i.name).isValidated()),n?void 0:!1}}),n)},isValid:function(){var t=this,n=!t._errorMessage;return n&&Ext.Array.each(t.fields,function(i){if(i.name!==t.idProperty)return n=!t.getMeta(i.name,"validationErrorMessages").length,n&&(i.isStoreField||i.isModelField)&&(n=t.get(i.name).isValid()),n?void 0:!1}),n},setMeta:function(n,t,i){var r=this;(t==="validationErrorMessages"||t==="validationInfoMessages")&&Ext.Error.raise('Direct set of "validationErrorMessages" or "validationInfoMessages" is forbidden');r.setMetaInternal(n,t,i)},setDefaultMeta:function(n,t,i,r){var u=this,f=u.getField(n);f&&(f[t]=i,u.setMeta(n,t,i,r))},getMeta:function(n,t){var i=this;return i._metaData[n][t]},resetMetaData:function(){var n=this;Ext.Array.forEach(n.fields,function(t){t.name!==n.idProperty&&(Ext.Object.each(n._metaData[t.name],function(i){i!=="validationErrorMessages"&&i!=="validationInfoMessages"&&n.setMeta(t.name,i,t[i])}),(t.isStoreField||t.isModelField)&&n.get(t.name).resetMetaData())})},getFieldValidationInfo:function(n){var t=this,i,r;return n!==t.idProperty?(i=t.getField(n),r=t._validationModel[n],{isValidated:r.isValidated,isValidating:r.isValidating,validationErrorMessages:t.getMeta(n,"validationErrorMessages"),validationInfoMessages:t.getMeta(n,"validationInfoMessages"),subInfo:i.isStoreField||i.isModelField?t.get(n).getAllValidationInfo():null}):null},getAllValidationInfo:function(){var n=this,t={};return Ext.Object.each(n._validationModel,function(i){t[i]=n.getFieldValidationInfo(i)}),t},onModelValidated:function(n,t){var i=this;Ext.each(i._validationCallbacks,function(i){i(n,t)});Ext.Array.erase(i._validationCallbacks,0,i._validationCallbacks.length)},onFieldValidated:function(n){var t=this,i=t._validationModel[n],r,u;if(i.isValidating=!1,i.isValidated=!0,t.executeFieldValidationCallbacks(n),r=t.getMeta(n,"validationErrorMessages"),u=t.getMeta(n,"validationInfoMessages"),t.fireEvent("validated",t,n,r,u),t.afterValidated([n]),!r.length&&!t._suppressValidChangeEvent&&!t.isEqual(i.lastValidValue,t.get(n))){i.lastValidValue=t.get(n);t.onValidChange(n)}},onValidChange:function(n){var t=this;t._suppressBusinessLogic||t.runBusinessRule(n,"ValidChange");t.fireEvent("validchange",t,n);t.afterValidChange([n])},onLoad:Ext.emptyFn,onClear:Ext.emptyFn,onModelChange:function(n){var t=this;Ext.each(n,function(n){t._suppressBusinessLogic||t.runBusinessRule(n,"Change")});t._suppressChangeEvent||t.fireChangeEvent(n);t._suppressValidityReset||t.resetValidity(n)},onMetaDataChange:function(n,t,i){var r=this;r.fireEvent("metadatachange",r,n,t,i);!r._suppressValidityReset&&r.validateOnMetaDataChange&&t!=="validationErrorMessages"&&t!=="validationInfoMessages"&&r.resetFieldValidity(n);r.afterMetaDataChange([n])},onBusinessRuleCompleted:function(){var n=this;n._businessRulesSyncCounter--;n._businessRulesSyncCounter===0&&n.onBusinessLogicCompleted()},onBusinessLogicCompleted:function(){var n=this;Ext.each(n._businessLogicSyncCallbacks,function(n){n()});Ext.Array.erase(n._businessLogicSyncCallbacks,0,n._businessLogicSyncCallbacks.length)},endEdit:function(n,t){var i=this;t||(t=i.getModifiedFieldNames(),t=t.concat(i._modifiedNestedFieldNames));i.callParent([n,t]);i._modifiedNestedFieldNames=[]},cancelEdit:function(){var n=this;n._modifiedNestedFieldNames=[];n.callParent(arguments)},afterEdit:function(n){var t=this;t.onModelChange(n)},getData:function(n){var t=this,i,r;return n=n||{},i=t.callParent(arguments),delete i[t.idProperty],r=t.data,Ext.Array.forEach(t.fields,function(u){u.name!==t.idProperty&&(n.includeViewFields||!t.getMeta(u.name,"viewField"))&&(u.isModelField?i[u.name]=r[u.name].getData():u.isStoreField&&(i[u.name]=r[u.name].getRawData()))}),i},commit:function(n,t,i){var r=this,u;r.callParent(arguments);i||(u=r.data,Ext.Array.forEach(r.fields,function(t){t.isModelField?u[t.name].commit(n):t.isStoreField&&u[t.name].commitChanges(n)}))},reject:function(n,t){var i=this,r,u=i.modified,f=[],e;for(r in u)u.hasOwnProperty(r)&&typeof u[r]!="function"&&f.push(r);if(i.callParent(arguments),t||(e=i.data,Ext.Array.forEach(i.fields,function(t){t.isModelField?e[t.name].reject(n):t.isStoreField&&e[t.name].rejectChanges()})),n&&i._suppressChangeEvent++,f.length)i.onModelChange(f);n&&i._suppressChangeEvent--},set:function(n,t,i){var r=this;i&&r._suppressChangeEvent++;r.callParent(arguments);i&&r._suppressChangeEvent--},afterValidated:function(n){var t=this;t.callJoined("afterValidated",n)},afterValidChange:function(n){var t=this;t.callJoined("afterValidChange",n)},resetFieldValidation:function(n){var t=this,i=t._validationModel[n];Ext.Array.erase(i.callbacks,0,i.callbacks.length);t._suppressValidChangeEvent=!0;t.resetValidationMessages(n);t.onFieldValidated(n);t._suppressValidChangeEvent=!1},performValidation:function(n,t,i){var u=this,r=u._validationModel[n],h=u.get(n),f=JSON.stringify(t),s=r.fieldState,e=f!==r.lastValidatingOptions||s!==r.fieldState,o;if(e&&(r.lastValidatingOptions=f),o=u._validationRules[n],i&&r.callbacks.push(i),!r.isValidating||e)if(r.isValidating=!0,r.isValidated&&!e)r.isValidating=!1,u.executeFieldValidationCallbacks(n);else if(o)o.call(u,h,t,function(t,i){if(s===r.fieldState&&r.lastValidatingOptions===f){u.setValidationMessages(n,t,i);u.onFieldValidated(n)}});else{u.resetValidationMessages(n);u.onFieldValidated(n)}},executeFieldValidationCallbacks:function(n){var t=this,i=t._validationModel[n];Ext.each(i.callbacks,function(i){i(t.getMeta(n,"validationErrorMessages"),t.getMeta(n,"validationInfoMessages"))});Ext.Array.erase(i.callbacks,0,i.callbacks.length)},resetValidity:function(n){var t=this;t.validateOnChange&&Ext.each(n,function(n){n!==t.idProperty&&t.resetFieldValidity(n)})},resetFieldValidity:function(n){var i=this,t;i.validateOnChange&&(t=i._validationModel[n],t.fieldState++,t.isValidated=!1,t.isValidating=!1,i.validateField(n,null))},afterMetaDataChange:function(n){var t=this;t.callJoined("afterMetaDataChange",n)},runBusinessRule:function(n,t){var i=this,r=n+t;i._businessRules[r]&&(i._businessRulesSyncCounter++,i._businessRules[r](i.get(n),i._businessRuleCompletedCallback))},tryCreateStandardValidatorRule:function(n){var i=this,t=null;return(Ext.isString(n)&&n.indexOf(".")===-1||Ext.isObject(n))&&(t=i.createStandardValidator(n)),t},createMappedValidators:function(n){var t=this,i=[],r=t.getField(n);return Ext.Object.each(t._metaDataModel,function(n){if(t._metaDataValidatorsMap[n]){var u=t.createMappedValidator(r,t._metaDataValidatorsMap[n]);i.push(u)}}),i},createMappedValidator:function(n,t){var u=this,i=t.config,r,f,e;return i=Ext.isString(i)?{type:i}:Ext.apply({},i),r=t.fieldConfigReplications,r&&Ext.Array.each(r,function(t){n[t]!==undefined&&(i[t]=n[t])}),f=t.activationRule,e=u.createStandardValidator(i),function(){return f(u,n.name)?e.apply(window,arguments):{errorMessage:"",infoMessage:""}}},createStandardValidator:function(n){var t=this,i=Ext.Factory.dataValidator(n);return i instanceof Ext.data.validator.ParametrizedValidator?function(n,r){var u=i.validateWithOptions(n,t,r),f="";return u!==!0&&(f=Ext.isString(u)&&u?u:t.defaultFieldErrorMessage),{errorMessage:f,infoMessage:i.getInfoMessage()}}:function(n){var r=i.validate(n,t),u="";return r!==!0&&(u=Ext.isString(r)&&r?r:t.defaultFieldErrorMessage),{errorMessage:u,infoMessage:""}}},createValidationRule:function(n){var t=this,u=Ext.Array.from(t.validationRules[n]),r=t.createMappedValidators(n),i=[];return(Ext.Array.each(u,function(n){var u=t.tryCreateStandardValidatorRule(n);u?r.push(u):i.push(t.createAsyncRule(n,t.defaultValidationService))}),!i.length&&!r.length)?null:function(n,u,f){var e=[],o=[],s,h;Ext.Array.each(r,function(t){var i=t(n,u);i.errorMessage&&e.push(i.errorMessage);i.infoMessage&&o.push(i.infoMessage)});!e.length&&i.length?(s=i.length,h=function(n,t){s--;n&&e.push(n);t&&o.push(t);s||f(e,o)},Ext.Array.each(i,function(i){i.call(t,n,u,h)})):f(e,o)}},createAsyncRule:function(n,t){var i=this,f;if(Ext.isFunction(n))return Ext.bind(n,i);var r=t,u=n,e=n.split(".");return e.length===2&&(r=e[0],u=e[1]),r==="this"?(i[u]||Ext.Error.raise(u+" is not defined"),i[u]):(f=null,f=Deft.Injector.canResolve(r)?Deft.Injector.resolve(r):i[r],Ext.bind(f[u],f,[i],0))},clearAllFields:function(n){var t=this;t.beginEdit();Ext.Array.forEach(t.fields,function(i){i.name!==t.idProperty&&(n&&Ext.Array.contains(n,i.name)||t.clearField(i.name))});t.endEdit()},clearField:function(n){var u=this,f=u.getField(n),i=u.get(n),e=f.useNull,r=f.defaultValue,t=null;if(f.isModelField||f.isStoreField){u.get(n).clear();return}Ext.isString(i)?t=r||"":Ext.isArray(i)?t=r||[]:Ext.isNumber(i)?t=r||(e?null:0):Ext.isBoolean(i)?t=r||(e?null:!1):Ext.isDate(i)&&(t=r||(e?null:""));u.set(n,t)},getNumOfFields:function(){return this.fields.length-1},getNumOfComplexFields:function(){var n=this,t=0;return Ext.Array.forEach(n.fields,function(i){i.name!==n.idProperty&&(i.isModelField||i.isStoreField)&&t++}),t},fireChangeEvent:function(n){var t=this,i=Ext.Array.remove(Ext.Array.clone(n),t._ignoredFieldNames);t._ignoredFieldNames.concat(i);t.fireEvent("change",t,i);Ext.Array.remove(t._ignoredFieldNames,i)},subscribeNestedModel:function(n,t){var i=this;n.on("change",i.onNestedModelChange,i,{fieldName:t})},onNestedModelChange:function(n,t,i){var r=this;r.editing?r._modifiedNestedFieldNames.push(i.fieldName):r.afterEdit([i.fieldName])},subscribeNestedStore:function(n,t){var i=this;n.on("datachanged",i.onNestedStoreChange,i,{fieldName:t});n.on("update",i.onNestedStoreUpdate,i,{fieldName:t})},onNestedStoreUpdate:function(n,t,i,r,u,f){var e=this;switch(i){case Ext.data.Model.EDIT:case Ext.data.Model.REJECT:e.editing?e._modifiedNestedFieldNames.push(f.fieldName):e.afterEdit([f.fieldName])}},setValidationMessages:function(n,t,i){var r=this;r.setMetaInternal(n,"validationInfoMessages",i||[],!0);r.setMetaInternal(n,"validationErrorMessages",t||[],!0)},resetValidationMessages:function(n){var t=this;t.setMetaInternal(n,"validationInfoMessages",[],!0);t.setMetaInternal(n,"validationErrorMessages",[],!0)},setMetaInternal:function(n,t,i,r){var u=this;if(!u.isEqual(u._metaData[n][t],i)){r&&u._suppressValidityReset++;u._metaData[n][t]=i;u.onMetaDataChange(n,t,i);r&&u._suppressValidityReset--}},onNestedStoreChange:function(n,t){var i=this;i.editing?i._modifiedNestedFieldNames.push(t.fieldName):i.afterEdit([t.fieldName])},getField:function(n){var t=this;return Ext.Array.findBy(t.fields,function(t){return t.name===n})},getStuckValidations:function(){var t=this,n=[];return Ext.Object.each(t._validationModel,function(t,i){i.callbacks.length&&n.push(t)}),n},statics:{initValidationRules:function(n,t,i){var r={},u,f;i._validationRules&&(u=i._validationRules,delete i._validationRules,r=Ext.merge(r,u));n._validationRules&&(f=n._validationRules,delete n._validationRules,r=Ext.merge(r,f));t._validationRules=i._validationRules=r},initBusinessRules:function(n,t,i){var r={},u,f;i._businessRules&&(u=i._businessRules,delete i._businessRules,r=Ext.merge(r,u));n._businessRules&&(f=n._businessRules,delete n._businessRules,r=Ext.merge(r,f));t._businessRules=i._businessRules=r},initMetaDataModel:function(n,t,i){var r={},u,f;i._metaDataModel&&(u=i._metaDataModel,delete i._metaDataModel,r=Ext.merge(r,u));n._metaDataModel&&(f=n._metaDataModel,delete n._metaDataModel,r=Ext.merge(r,f));t._metaDataModel=i._metaDataModel=r},initMetaDataValidatorsMap:function(n,t,i){var r={},u,f;i._metaDataValidatorsMap&&(u=i._metaDataValidatorsMap,delete i._metaDataValidatorsMap,r=Ext.merge(r,u));n._metaDataValidatorsMap&&(f=n._metaDataValidatorsMap,delete n._metaDataValidatorsMap,r=Ext.merge(r,f));t._metaDataValidatorsMap=i._metaDataValidatorsMap=r}}},function(){var n=this;n.onExtended(function(t,i){var r=t.prototype;n.initValidationRules(i,t,r);n.initBusinessRules(i,t,r);n.initMetaDataModel(i,t,r);n.initMetaDataValidatorsMap(i,t,r)})});Ext.data.Model.addStatics({METACHANGE:"metachange",VALIDCHANGE:"validchange",VALIDATED:"validated"});Ext.define("Ext.ux.data.AsyncStore",{extend:"Ext.data.Store",selectionModel:null,current:null,constructor:function(){var n=this;n._validationCallbacks=[];n._businessLogicSyncCallbacks=[];n.callParent(arguments);n.recordBusinessLogicCompletedCallback=function(){n.onRecordBusinessLogicCompleted()}},applyModelConfig:function(n){var t=this;t._modelConfig=n;t.each(function(t){Ext.apply(t,n)})},syncWithBusinessRules:function(n){var t=this;t.businessRulesSyncCounter=t.count();t.each(function(n){n.syncWithBusinessRules(t.recordBusinessLogicCompletedCallback)});t.businessRulesSyncCounter===0?Ext.callback(n):t._businessLogicSyncCallbacks.push(n)},getRawData:function(n){var i=this,t=[];return i.each(function(i){t.push(i.getData(n))}),t},clear:function(){var n=this;n.removeAll();Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},validate:function(n,t){var i=this;if(t&&i._validationCallbacks.push(t),!i.isValidating){var f=i.count(),r=[],u=[],e=function(t,e){if(r=r.concat(t),u=u.concat(e),f--,f===0)if(i.isValidating=!1,i.isValidated())i.onStoreValidated(r,u);else i.validate(n)};if(f)i.isValidating=!0,i.each(function(t){t.validate(n,e)});else i.onStoreValidated(r,u)}},resetMetaData:function(){var n=this;n.each(function(n){n.resetMetaData()})},resetValidation:function(){var n=this;n.each(function(n){n.resetValidation()});Ext.Array.erase(n._validationCallbacks,0,n._validationCallbacks.length)},isValidated:function(){var t=this,n=!0;return t.each(function(t){return n=t.isValidated(),n?void 0:!1}),n},isValid:function(){var t=this,n=!0;return t.each(function(t){return n=t.isValid(),n?void 0:!1}),n},getAllValidationInfo:function(){var t=this,n=[];return t.each(function(t){n.push(t.getAllValidationInfo())}),n},onRecordBusinessLogicCompleted:function(){var n=this;n.businessRulesSyncCounter--;n.businessRulesSyncCounter===0&&n.onBusinessLogicCompleted()},onBusinessLogicCompleted:function(){var n=this;Ext.each(n._businessLogicSyncCallbacks,function(n){Ext.callback(n)});Ext.Array.erase(n._businessLogicSyncCallbacks,0,n._businessLogicSyncCallbacks.length)},onStoreValidated:function(n,t){var i=this;Ext.each(i._validationCallbacks,function(i){i(n,t)});Ext.Array.erase(i._validationCallbacks,0,i._validationCallbacks.length)},createModel:function(){var n=this,t=n.callParent(arguments);return n._modelConfig&&Ext.apply(t,n._modelConfig),t},afterMetaDataChange:function(n,t){this.getData().itemChanged(n,t||null,undefined,Ext.data.Model.METACHANGE)},afterValidChange:function(n,t){this.getData().itemChanged(n,t||null,undefined,Ext.data.Model.VALIDCHANGE)}});
//# sourceMappingURL=ext-asyncmodel-all.min.js.map
